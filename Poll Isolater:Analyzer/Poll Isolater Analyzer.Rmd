---
title: "Pollster Analyzer"
author: "Haley Reed"
date: "5/29/2020"
output: html_document
bibliography: electionworkingbib.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_knit$set(root.dir = dirname(getwd()))
```

This file uses data from the FiveThirtyEight repository to isolate an individual pollster and their most recent polls at the time of every election in the dataset for the indicated years.

```{r, echo=FALSE}
#load the data
#538
mydata <- read.csv("raw-polls_538.csv")
```

```{r, echo=TRUE}
#Establish which pollster you wish to analyze:
pollsterOfChoice="SurveyUSA"
#Establish which years you wish to use data from (between 1998 and 2020):
earlyYear=1998
lateYear=2020
```

This file will analyze data from `r pollsterOfChoice` between the years of `r earlyYear` and `r lateYear`. This particular subset of data is shown in the table below:

```{r, include=FALSE}
#Subset for constraints given above.
mydata=(subset(mydata,pollster==pollsterOfChoice))
mydata=(subset(mydata, mydata$year>=1998))
mydata=(subset(mydata, mydata$year<=2020))

#load lubridate for dates, change dates to date data type. 
library(lubridate)
mydata$electiondate = mdy(mydata$electiondate)
mydata$polldate = mdy(mydata$polldate)

#load the the survival package (needed to find nearest date)
#library(survival)

#Use only the most recent poll for each election:
library(data.table)
library(knitr)
```

```{r, echo=FALSE}
kable(setDT(mydata)[,.SD[which.max(polldate)],keyby=race_id])
onlyRecentData=(setDT(mydata)[,.SD[which.max(polldate)],keyby=race_id])
```

The density plot and summary statistics for margin of error for `r pollsterOfChoice` between the years of `r earlyYear` and `r lateYear` is shown below.

```{r, echo=FALSE}
plot(onlyRecentData$electiondate,onlyRecentData$error, main="Margin of Error of Polls", xlab="Election Date", ylab="Margin of Error")
abline(0,0,col="blue")  

summary(onlyRecentData$error)
```

The density plot and summary statistics for bias towards Republican candidates is shown below:

```{r, echo=FALSE}
twoPartyTicket=subset(onlyRecentData,cand1_party!=cand2_party)
plot(twoPartyTicket$electiondate,twoPartyTicket$bias, main="Bias of Polls towards Republican Candidates", xlab="Election Date", ylab="Bias")
abline(0,0,col="blue")
summary(twoPartyTicket$bias)
```

Additionally, `r pollsterOfChoice` correctly predicted `r mean(onlyRecentData$rightcall)*100`% of races in their last poll for every election polled from `r earlyYear` to `r lateYear`.

\newpage
## Works Cited

---
#.bib for bib refrence
nocite: |
  @538rawpolldata

---
